<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="assets_frontend" inherit_id="website.assets_frontend" name="Contract Manager">
      <xpath expr="." position="inside">
          <link rel='stylesheet' href='/website_contract/static/src/css/website_contract.less'/>
      </xpath>
    </template>

    <template id="contract" name="Contracts">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-4">
                            <ol class="breadcrumb">
                                <li><a href="/account">My Account</a></li>
                                <li>Contract <t t-esc="account.name"/></li>
                            </ol>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Contract Details</h3>
                            <div class="col-md-5 col-md-offset-1">
                                <h4>Status</h4>
                                <p><strong>Current status: </strong>
                                    <t t-if="account.state == 'open'">
                                        <span class="label label-success"><i class="fa fa-fw fa-check"/> Running</span>
                                    </t>
                                    <t t-if="account.state == 'pending'">
                                        <span class="label label-warning"><i class="fa fa-fw fa-refresh"/> To Renew</span>
                                    </t>
                                    <t t-if="account.state == 'close'">
                                        <span class="label label-default"><i class="fa fa-fw fa-remove"/> Closed</span>
                                    </t>
                                    <t t-if="account.state == 'cancelled'">
                                        <span class="label label-danger"><i class="fa fa-fw fa-ban"/> Cancelled</span>
                                    </t>
                                </p>
                                <p><strong>Valid until: </strong><t t-esc="account.date"/></p>
                                <p><strong>Billing/renewal: </strong>
                                    Every 
                                    <t t-esc="account.recurring_interval"/>
                                    <t t-if="account.recurring_rule_type=='daily'">
                                        day(s)
                                    </t>
                                    <t t-if="account.recurring_rule_type=='weekly'">
                                        week(s)
                                    </t>
                                    <t t-if="account.recurring_rule_type=='monthly'">
                                        month(s)
                                    </t>
                                    <t t-if="account.recurring_rule_type=='yearly'">
                                        years(s)
                                    </t>
                                </p>
                                <p><strong>Next invoice date: </strong><t t-esc="account.recurring_next_date"/></p>
                                <br/>

                                <p><strong>Subtotal: </strong>
                                    <span t-field="account.full_price" t-field-options='{"widget": "monetary", "display_currency": "account.company_id.currency_id"}'/>
                                </p>
                                <p><strong>Taxes: </strong>17.36 €</p>
                                <p><strong>Total: </strong>100 €</p>
                            </div>
                            <div class="col-md-5">
                                <h4>Invoice Address</h4>
                                    <div t-field="account.partner_id" t-field-options='{
                                        "widget": "contact",
                                        "fields": [
                                            "name",
                                            "address",
                                            "phone",
                                            "mobile",
                                            "fax",
                                            "email"]}'/>

                                <h4>Technical Contact</h4>
                                <div t-field="account.manager_id" t-field-options='{
                                        "widget": "contact",
                                        "fields": [
                                            "name",
                                            "address",
                                            "phone",
                                            "email"]}'/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Your Plan <button class="btn btn-primary">Change Plan</button></h3>
                            <div class="row row-centered">
                                <t t-foreach="account_templates" t-as="template">
                                    <t t-call="website_contract.template_panel"/>
                                </t>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <h3>Active Options</h3>
                            <table class="table table-default">
                                <t t-foreach="account.template_id.recurring_invoice_line_ids" t-as="invoice_line">
                                    <t t-if="invoice_line in account.recurring_invoice_line_ids">
                                        <t t-call="website_contract.template_option" />
                                    </t>
                                </t>
                            </table>
                        </div>
                        <div class="col-md-12">
                            <h3>Add Options</h3>
                            <table class="table table-default">
                                <t t-foreach="account.template_id.recurring_invoice_line_ids" t-as="invoice_line">
                                    <t t-if="invoice_line not in account.recurring_invoice_line_ids">
                                        <t t-call="website_contract.template_option" />
                                    </t>
                                </t>
                            </table>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Terms and conditions</h3>
                            <t t-raw="terms"/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="template_panel">
        <div class="col-centered col-md-3">
            <div t-att-class="'panel panel-primary' if (account.template_id.id == template.id) else 'panel panel-default'">
                <div class="panel-heading">
                    <h3 class="panel-title text-center" t-esc="template.name"/>
                </div>
                <div class="panel-body">
                    <ul class='list-unstyled'>
                        <t t-foreach="template.recurring_invoice_line_ids" t-as="invoice_line">
                            <t t-if="invoice_line.type=='mandatory'">
                                <li t-esc="invoice_line.product_id.name_template"/>
                            </t>
                        </t>
                    </ul>
                    <hr/>
                    <t t-raw="template.plan_description" />
                </div>
                <div class="panel-footer">
                    <p class="text-center" t-field="template.base_price" t-field-options='{"widget": "monetary", "display_currency": "template.company_id.currency_id"}'/>
                </div>
            </div>
        </div>
    </template>

    <template id="template_option">
        <t t-if="invoice_line.type=='optional'">
            <tr>
                <td t-esc="invoice_line.product_id.name_template"/>
                <td><t t-esc="invoice_line.quantity"/> Unit</td>
                <td t-esc="invoice_line.price_subtotal"/>
            </tr>
        </t>
    </template>


</odoo>